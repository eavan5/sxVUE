{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 切片编程\n\n\nlet oldArrayProtoMethods = Array.prototype;\n\n//继承一下\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\n\nlet methods = [\n  'push',\n  'pop',\n  'unshift',\n  'shift',\n  'reverse',\n  'splice',\n  'sort'\n]\nmethods.forEach(method => {\n  arrayMethods[method] = function (...args) {  //这里的this就是observer的data\n    console.log('数组方法被调用了');\n    const result = oldArrayProtoMethods[method].apply(this, arguments)\n    let inserted\n    switch (method) {\n      case 'push':\n      case 'unshift': //这两个内容都是添加,添加的内容可能是对象类型,应该再次进行劫持\n        inserted = args\n        break;\n      case 'splice': //vue.$set原理\n        inserted = args.slice(2) // 第3个就是新增的数据\n      default:\n        break;\n    }\n    //如果当前的inserted有值 则继续检测\n    if (inserted) observeArray(inserted)\n    return result\n  }\n})\n\n\n\n","import { arrayMethods } from './array'\nclass Observer {\n  constructor(data) {\n    if (Array.isArray(data)) {\n      Object.setPrototypeOf(data, arrayMethods)\n      //观测数组中的对象类型,对象变化也需要做一些事\n      this.observeArray(data)\n    } else {\n      //使用defineProperty 重新定义属性\n      this.walk(data)\n    }\n  }\n  observeArray(data) {\n    data.forEach(item => {\n      observe(item)\n    })\n  }\n  walk(data) {\n    let keys = Reflect.ownKeys(data)\n    // console.log(keys);\n    keys.forEach(key => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  observe(value) // 递归下去\n  Object.defineProperty(data, key, {\n    get() {\n      console.log('获取值');\n      return value\n    },\n    set(newValue) {\n      console.log('设置值');\n      if (newValue === value) return\n      observe(newValue)  //如果用户设置的值还是一个对象,继续观测\n      value = newValue\n    }\n  })\n\n}\n\nexport function observe(data) {\n  // Object.defineProperty实际上也是可以对数组进行监控的，但是由于监控数组会去递归数组，会造成性能问题，所以改用数组原型重写的方法\n\n\n  // 如果不是对象直接return\n  if (typeof data !== 'object' || data === null) return\n  return new Observer(data)\n}","\nimport {observe} from './observer/index'\nexport function initState(vm) {\n  const options = vm.$options;\n  if (options.props) {\n    initProps(vm)\n  }\n  if (options.methods) {\n    initMethods(vm)\n  }\n  if (options.data) {\n    initData(vm)\n  }\n  if (options.computed) {\n    initComputed(vm)\n  }\n  if (options.watch) {\n    initWatch(vm)\n  }\n}\n\nfunction initProps() {\n\n}\n\nfunction initMethods() {\n\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data\n  // 判断data是否是函数,兼容函数或者对象\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data\n  \n  //数据的劫持方案  对象Object.defineProperty\n  //数组 单独处理的\n  observe(data)\n}\n\nfunction initComputed() {\n\n}\n\nfunction initWatch() {\n\n}","import { initState } from './state'\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n\n    //初始化状态\n    initState(vm)\n\n    //初始化事件...\n  }\n\n}","import { initMixin } from './init'\nfunction Vue(options) {\n  this._init(options) // 初始化操作\n}\n\n//Vue初始化方法\ninitMixin(Vue)\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","console","log","result","apply","arguments","inserted","slice","observeArray","Observer","data","isArray","setPrototypeOf","walk","item","observe","keys","Reflect","ownKeys","key","defineReactive","value","defineProperty","get","set","newValue","initState","vm","options","$options","props","initData","computed","watch","_data","call","initMixin","Vue","_init"],"mappings":"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"}